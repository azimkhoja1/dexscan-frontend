<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DexScan PRO</title>
<style>
  body {
    background-color: #0c0c0c;
    color: #fff;
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
  }
  header {
    background: #111;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    border-bottom: 1px solid #333;
  }
  .title {
    font-weight: bold;
    color: cyan;
    font-size: 1.2em;
  }
  .header-prices {
    font-size: 0.95em;
    color: #0ff;
  }
  .status {
    font-size: 0.85em;
    color: #0f0;
  }
  main {
    padding: 15px;
  }
  .controls {
    margin-bottom: 20px;
  }
  button {
    background: cyan;
    border: none;
    color: #000;
    font-weight: 600;
    padding: 8px 14px;
    border-radius: 5px;
    margin-right: 10px;
    cursor: pointer;
  }
  button:hover { opacity: 0.8; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #333;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #1a1a1a;
    color: #0ff;
  }
  #balance {
    margin-top: 10px;
    font-size: 0.95em;
    color: #0ff;
  }
</style>
</head>
<body>

<header>
  <div class="title">DexScan PRO</div>
  <div class="header-prices">BTC: -- | ETH: -- | BNB: --</div>
  <div class="status" id="backend-status">Backend: Checking...</div>
</header>

<main>
  <div class="controls">
    <button id="deep-scan">üîç Deep Scan</button>
    <button id="auto-scan">Auto Scan: OFF</button>
    <button id="auto-trade">Auto Trade: OFF</button>
    <button id="mode-toggle">Mode: DEMO</button>
  </div>

  <h3>üìä Scanner Results</h3>
  <table>
    <thead>
      <tr>
        <th>Symbol</th><th>Entry</th><th>TP1</th><th>TP2</th><th>TP3</th><th>Potential</th><th>Hours</th><th>Score</th>
      </tr>
    </thead>
    <tbody id="scanner-body"><tr><td colspan="8">Waiting...</td></tr></tbody>
  </table>

  <h3>üíº Trades & Wallet</h3>
  <div id="balance">Balance: 10000.00 USDT</div>
</main>

<script>
const BACKEND = "https://dexscan-backend.onrender.com";
const headerEl = document.querySelector('.header-prices');
const statusEl = document.getElementById('backend-status');
const tableBody = document.getElementById('scanner-body');
const deepScanBtn = document.getElementById('deep-scan');
const autoScanBtn = document.getElementById('auto-scan');
const modeBtn = document.getElementById('mode-toggle');
const balanceEl = document.getElementById('balance');

let autoScan = false;

// ---- Backend Status ----
async function checkBackend() {
  try {
    const res = await fetch(`${BACKEND}/`);
    if (res.ok) statusEl.innerHTML = 'Backend connected ‚úÖ';
    else throw new Error();
  } catch {
    statusEl.innerHTML = 'Backend not reachable ‚ùå';
  }
}

// ---- Header Prices ----
async function loadHeader() {
  try {
    const res = await fetch(`${BACKEND}/api/header`);
    const data = await res.json();
    headerEl.textContent = `BTC: ${data.btc || '--'} | ETH: ${data.eth || '--'} | BNB: ${data.bnb || '--'}`;
  } catch {
    headerEl.textContent = `BTC: -- | ETH: -- | BNB: --`;
  }
}

// ---- Deep Scan ----
async function deepScan() {
  try {
    tableBody.innerHTML = "<tr><td colspan='8'>Scanning...</td></tr>";
    const res = await fetch(`${BACKEND}/api/coins`);
    const coins = await res.json();
    if (!coins.length) {
      tableBody.innerHTML = "<tr><td colspan='8'>No coins found</td></tr>";
      return;
    }
    tableBody.innerHTML = coins.map(c => `
      <tr>
        <td>${c.symbol}</td>
        <td>${parseFloat(c.entry).toFixed(8)}</td>
        <td>${parseFloat(c.tp1).toFixed(8)}</td>
        <td>${parseFloat(c.tp2).toFixed(8)}</td>
        <td>${parseFloat(c.tp3).toFixed(8)}</td>
        <td>${c.potential}</td>
        <td>${c.hours}h</td>
        <td>${c.score}</td>
      </tr>
    `).join('');
  } catch (err) {
    tableBody.innerHTML = "<tr><td colspan='8'>Error loading coins</td></tr>";
  }
}

// ---- Auto Scan ----
autoScanBtn.addEventListener("click", () => {
  autoScan = !autoScan;
  autoScanBtn.textContent = `Auto Scan: ${autoScan ? "ON" : "OFF"}`;
  if (autoScan) startAutoScan();
});
function startAutoScan() {
  if (!autoScan) return;
  deepScan();
  setTimeout(startAutoScan, 60000);
}

// ---- Mode Toggle ----
modeBtn.addEventListener("click", () => {
  const current = modeBtn.textContent.includes("DEMO") ? "LIVE" : "DEMO";
  modeBtn.textContent = `Mode: ${current}`;
});

// ---- Events ----
deepScanBtn.addEventListener("click", deepScan);
setInterval(loadHeader, 15000);
checkBackend();
loadHeader();
deepScan();
</script>
</body>
</html>
