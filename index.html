<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DexScan PRO</title>
<style>
  body{background:#0d1117;color:#e6edf3;font-family:Segoe UI,Arial,sans-serif;margin:0;padding:0;}
  header{background:#161b22;color:#00eaff;display:flex;justify-content:space-between;align-items:center;padding:10px 20px;font-weight:600;}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin:10px 20px;}
  button{background:#00eaff;border:none;color:#000;padding:8px 14px;border-radius:6px;cursor:pointer;font-weight:600;}
  button:hover{opacity:0.85;}
  table{width:calc(100% - 40px);margin:10px 20px;border-collapse:collapse;}
  th,td{padding:8px 10px;text-align:left;}
  th{background:#161b22;color:#00eaff;}
  tr:nth-child(even){background:#1b1f24;}
  tr:nth-child(odd){background:#111418;}
  .green{color:#00ff88;font-weight:600;}
  .red{color:#ff5c5c;font-weight:600;}
  .blink{animation:blink 0.4s linear;}
  @keyframes blink{0%{background:#003;}50%{background:#040;}100%{background:inherit;}}
  footer{text-align:center;padding:10px;color:#555;font-size:13px;}
</style>
</head>
<body>
<header>
  <div>DexScan PRO</div>
  <div id="headerPrices">BTC: -- | ETH: -- | BNB: --</div>
  <div id="backendStatus" style="font-size:12px;">Backend: connecting...</div>
</header>

<div class="controls">
  <button id="btnScan">üîç Deep Scan</button>
  <button id="btnAutoScan">Auto Scan: OFF</button>
  <button id="btnAutoTrade">Auto Trade: OFF</button>
  <button id="btnMode">Mode: DEMO</button>
</div>

<h3 style="margin-left:20px;">üìä Scanner Results</h3>
<table id="scanTable">
  <thead><tr><th>Symbol</th><th>Entry</th><th>TP1</th><th>TP2</th><th>TP3</th><th>Potential</th><th>Hours</th><th>Score</th><th>Action</th></tr></thead>
  <tbody></tbody>
</table>

<h3 style="margin-left:20px;">üíº Trades & Wallet</h3>
<table id="tradeTable">
  <thead><tr><th>Symbol</th><th>Entry</th><th>Latest</th><th>PNL%</th><th>Status</th><th>Action</th></tr></thead>
  <tbody></tbody>
</table>

<p style="margin-left:20px;">Balance: <span id="balance">-- USDT</span></p>

<footer>DexScan PRO v4.0 | Updated for AI Smart Scanner + Auto Trader</footer>

<script>
const API="https://dexscan-backend.onrender.com";
const scanT=document.querySelector("#scanTable tbody");
const tradeT=document.querySelector("#tradeTable tbody");
const headP=document.getElementById("headerPrices");
const backStat=document.getElementById("backendStatus");
let autoScan=false,autoTrade=false,demoMode=true;

// backend status
async function pingBackend(){
  try{
    const r=await fetch(API+"/api/header");
    if(!r.ok)throw new Error();
    const j=await r.json();
    headP.textContent=`BTC:${j.btc||"--"} | ETH:${j.eth||"--"} | BNB:${j.bnb||"--"}`;
    backStat.innerHTML="Backend connected ‚úÖ";
  }catch(e){
    backStat.innerHTML="Backend not reachable ‚ùå";
  }
}

// load scan results
async function loadScan(){
  try{
    const r=await fetch(API+"/api/scan/results");
    const j=await r.json();
    scanT.innerHTML="";
    j.forEach(c=>{
      const row=document.createElement("tr");
      row.innerHTML=`
      <td>${c.symbol}</td>
      <td>${(+c.entry).toFixed(8)}</td>
      <td>${(+c.tp1).toFixed(8)}</td>
      <td>${(+c.tp2).toFixed(8)}</td>
      <td>${(+c.tp3).toFixed(8)}</td>
      <td>${c.potential}</td>
      <td>${c.hours||"?"}</td>
      <td>${c.score}</td>
      <td><button onclick="buyCoin('${c.symbol}')">Buy</button></td>`;
      scanT.appendChild(row);
    });
  }catch(e){scanT.innerHTML=`<tr><td colspan=9>Error loading scan</td></tr>`;}
}

// deep scan
async function deepScan(){
  document.getElementById("btnScan").innerText="‚è≥ Scanning...";
  await fetch(API+"/api/scan/run",{method:"POST"});
  await loadScan();
  document.getElementById("btnScan").innerText="üîç Deep Scan";
}

// buy
async function buyCoin(sym){
  const r=await fetch(API+"/api/trade/buy",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol:sym})});
  await loadTrades();
}

// sell
async function sellTrade(id){
  await fetch(API+"/api/trade/sell",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({trade_id:id})});
  await loadTrades();
}

// load trades
async function loadTrades(){
  try{
    const r=await fetch(API+"/api/trades");
    const j=await r.json();
    tradeT.innerHTML="";
    j.forEach(t=>{
      const pnl=(((t.latest_price||t.entry_price)-t.entry_price)/t.entry_price*100).toFixed(2);
      const color=pnl>=0?"green":"red";
      const row=document.createElement("tr");
      row.innerHTML=`
      <td>${t.symbol}</td>
      <td>${(+t.entry_price).toFixed(8)}</td>
      <td>${(+t.latest_price).toFixed(8)||"--"}</td>
      <td class="${color}">${pnl}%</td>
      <td>${t.status}</td>
      <td>${t.status==="OPEN"?`<button onclick="sellTrade('${t.id}')">Sell</button>`:"--"}</td>`;
      tradeT.appendChild(row);
    });
  }catch(e){tradeT.innerHTML=`<tr><td colspan=6>Error loading trades</td></tr>`;}
}

// mode toggle
document.getElementById("btnMode").onclick=async()=>{
  demoMode=!demoMode;
  await fetch(API+"/api/mode",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({demo:demoMode})});
  document.getElementById("btnMode").innerText="Mode: "+(demoMode?"DEMO":"LIVE");
};

// auto scan toggle
document.getElementById("btnAutoScan").onclick=()=>{
  autoScan=!autoScan;
  document.getElementById("btnAutoScan").innerText="Auto Scan: "+(autoScan?"ON":"OFF");
};

// auto trade toggle
document.getElementById("btnAutoTrade").onclick=async()=>{
  autoTrade=!autoTrade;
  await fetch(API+"/api/auto",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled:autoTrade})});
  document.getElementById("btnAutoTrade").innerText="Auto Trade: "+(autoTrade?"ON":"OFF");
};

// loopers
setInterval(pingBackend,8000);
setInterval(loadTrades,5000);
setInterval(()=>{if(autoScan)deepScan();},60000);

// init
pingBackend();
loadScan();
loadTrades();
document.getElementById("btnScan").onclick=deepScan;
</script>
</body>
</html>
